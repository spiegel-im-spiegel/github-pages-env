+++
title = "Bluetooth 実装の脆弱性に関する覚え書き"
date =  "2017-09-14T20:09:19+09:00"
update =  "2017-10-04T10:24:33+09:00"
description = "各 Bluetooth 実装に対して複数の脆弱性が存在する。特に古い Android 機器はベンダからのサポートを受けられない可能性が高いため Bluetooth を無効にすることを強く推奨する。"
tags = [
  "security",
  "vulnerability",
  "bluetooth",
  "blueborne",
]

[author]
  name      = "Spiegel"
  url       = "http://www.baldanders.info/spiegel/profile/"
  avatar    = "/images/avatar.jpg"
  license   = "by-sa"
  github    = "spiegel-im-spiegel"
  twitter   = "spiegel_2007"
  tumblr    = "spiegel-im-spiegel"
  instagram = "spiegel_2007"
  flickr    = "spiegel"
  facebook  = "spiegel.im.spiegel"
  linkedin  = "spiegelimspiegel"
  flattr    = "spiegel"
+++

- [BlueBorne Information from the Research Team - Armis Labs](https://www.armis.com/blueborne/)
- [Vulnerability Note VU#240311 - Multiple Bluetooth implementation vulnerabilities affect many devices](https://www.kb.cert.org/vuls/id/240311)
- [Bluetooth の実装における脆弱性 "BlueBorne" に関する注意喚起](http://www.jpcert.or.jp/at/2017/at170037.html)
- [JVNVU#95513538: 様々な Bluetooth 実装に複数の脆弱性](https://jvn.jp/vu/JVNVU95513538/)
- [Bluetooth の実装における複数の脆弱性について：IPA 独立行政法人 情報処理推進機構](https://www.ipa.go.jp/security/ciadr/vul/20170914_blueborne.html)
- [セキュリティホール memo の情報](https://www.st.ryukoku.ac.jp/~kjm/security/memo/2017/09.html#20170913_bluetooth)

## 脆弱性の内容

{{< fig-youtube id="LLNtZKpL0P8" width="500" height="281" title="Armis - BlueBorne Explained - YouTube" >}}

各 Bluetooth 実装に対して複数の脆弱性が存在する（「[JVNVU#95513538](https://jvn.jp/vu/JVNVU95513538/)」より抜粋）。

- バッファオーバーフロー（CVE-2017-1000251）： Linux カーネルの BlueZ モジュールに含まれる L2CAP の実装に脆弱性がある
- 領域外メモリ参照（CVE-2017-1000250）： Linux 向けの BlueZ モジュールには、SDP（Service Discovery Protocol） の実装に脆弱性がある
- 領域外読み込み（CVE-2017-0785）： Android の Bluetooth ソフトウェア・スタックにおいて SDP の実装に脆弱性がある
- ヒープベースのバッファオーバーフロー（CVE-2017-0781）： Android における BNEP (Bluetooth Network Encapsulation Protocol) の実装では、誤ったバッファサイズが memcpy 関数に渡される
- 整数アンダーフロー（CVE-2017-0782）： Android における BNEP の実装では、`bnep_process_control_packet` 関数において減算処理前のサイズチェックが適切に行われない脆弱性がある
- ヒープベースのバッファオーバーフロー（CVE-2017-14315）： Apple の Bluetooth Low-Energy Audio Protocol (LEAP) 実装では、受信したデータの CID を適切に検証しない問題がある
- 中間者攻撃（CVE-2017-0783, CVE-2017-8628）： Android および Windows における Bluetooth の PAN プロファイル実装には、認証回避の脆弱性がある

これは酷いな（笑）

今回の脆弱性が厄介なのは攻撃者の機器とペアリングしていない状態でも機器が乗っ取られる可能性があるということだ。

{{< fig-youtube id="Az-l90RCns8" width="500" height="281" title="Blueborne - Android Take Over Demo - YouTube" >}}

## 影響度（CVSS）

- [Vulnerability Note VU#240311 - Multiple Bluetooth implementation vulnerabilities affect many devices](https://www.kb.cert.org/vuls/id/240311)

**CVSSv2 基本評価値 7.9 (`AV:A/AC:M/Au:N/C:C/I:C/A:C`)**

| 基本評価基準                            | 評価値            |
|----------------------------------------:|:------------------|
| 攻撃元区分（AV）                        | 隣接ネットワーク（A） |
| 攻撃条件の複雑さ（AC）                  | 中（M）           |
| 攻撃前の認証要否（Au）                  | 不要（N）         |
| 情報漏えいの可能性（機密性への影響, C） | 全面的（C）       |
| 情報改ざんの可能性（完全性への影響, I） | 全面的（C）       |
| 業務停止の可能性（可用性への影響, A）   | 全面的（C）       |

CVSS については[解説ページ]({{< relref "remark/2015/cvss-v3-metrics-in-jvn.md" >}})を参照のこと。

## 影響を受ける製品

- Android : セキュリティパッチ レベル 2017年9月を適用していない Android
- Windows : 2017年9月マイクロソフトセキュリティ更新プログラムを適用していない Windows Vista 以降の Windows
- Linux : Kernel 3.3-rc1 以降のバージョン， BlueZ すべてのバージョン
- iOS, tvOS : iOS 9.3.5 およびそれ以前、AppleTV tvOS 7.2.2 およびそれ以前

ただし，上記以外の機器でも脆弱性が存在する可能性がある。
[Vulnerability Note Database の情報](https://www.kb.cert.org/vuls/id/240311 "Vulnerability Note VU#240311 - Multiple Bluetooth implementation vulnerabilities affect many devices")に常に留意すること。

スマートホーム全滅かな（笑）

## 対策・回避策

- Android : セキュリティパッチ レベル 2017年9月を適用すること
    - [Android Security Bulletin—September 2017  |  Android Open Source Project](https://source.android.com/security/bulletin/2017-09-01)
    - [BlueBorne Vulnerability Scanner by Armis - Google Play](https://play.google.com/store/apps/details?id=com.armis.blueborne_detector) : 検証用の Android アプリ
- Windows : [2017年9月マイクロソフトセキュリティ更新プログラム](https://blogs.technet.microsoft.com/jpsecurity/2017/09/13/201709-security-bulletin/)を適用すること
    - [CVE-2017-8628 | Microsoft Bluetooth ドライバーのなりすましの脆弱性](https://portal.msrc.microsoft.com/ja-JP/security-guidance/advisory/CVE-2017-8628)
- Linux : 各ディストリビュータの情報に従い最新ソフトウェアを適用すること
    - [Blueborne - Linux Kernel Remote Denial of Service in Bluetooth subsystem - CVE-2017-1000251 - Red Hat Customer Portal](https://access.redhat.com/security/vulnerabilities/blueborne)
    - [SecurityTeam/KnowledgeBase/BlueBorne - Ubuntu Wiki](https://wiki.ubuntu.com/SecurityTeam/KnowledgeBase/BlueBorne)
    - [Linux Kernelの脆弱性(Blueborne: CVE-2017-1000251) — | サイオスOSS | サイオステクノロジー](https://oss.sios.com/security/kernel-security-vulnerability-20170912)
- iOS, tvOS : iOS 10.x, tvOS 10.x で修正済み

修正版を受けられない場合は Bluetooth を無効にすることで回避できる。
特に古い Android 機器はベンダからのサポートを受けられない可能性が高いため Bluetooth を無効にすることを強く推奨する。

## ブックマーク

- [新たに発見されたBluetoothの脆弱性はスマートフォンを10秒で乗っ取られる | TechCrunch Japan](http://jp.techcrunch.com/2017/09/13/20170912new-bluetooth-vulnerability-can-hack-a-phone-in-ten-seconds/)
- [数十億を超えるBluetooth機器に影響、ペアリングなしで乗っ取られる脆弱性“BlueBorne”が明らかに - 窓の杜](http://forest.watch.impress.co.jp/docs/news/1080685.html)
- [Bluetooth実装の脆弱性「BlueBorne」、82億台に影響　無線経由で攻撃の恐れ - ITmedia エンタープライズ](http://www.itmedia.co.jp/enterprise/articles/1709/14/news048.html)
- [多数のBluetooth接続機器に影響する脆弱性--セキュリティ企業が警告 - ZDNet Japan](https://japan.zdnet.com/article/35107191/)
- [Bluetoothの脆弱性「BlueBorne」はIoT機器を狙う!? - MONOist（モノイスト）](http://monoist.atmarkit.co.jp/mn/articles/1709/15/news081.html)
- [BlueBorne脆弱性スキャナをためしてみる - ただのにっき(2017-09-14)](http://sho.tdiary.net/20170914.html#p01)
- [使っていないBluetoothを「必ずオフ」にしておくべき理由｜WIRED.jp](https://wired.jp/2017/10/02/turn-off-bluetooth-security/)
