+++
date = "2017-02-06T21:46:26+09:00"
update = "2017-03-09T14:03:47+09:00"
title = "WordPress 4.7 における REST API の脆弱性"
draft = false
tags = ["security", "vulnerability", "cms"]
description = "国内の複数のサイトが改ざん被害を受けているとの報告があり速やかに対策を実施する必要がある。"

[author]
  name = "Spiegel"
  flattr = ""
  linkedin = "spiegelimspiegel"
  tumblr = ""
  twitter = "spiegel_2007"
  github = "spiegel-im-spiegel"
  avatar = "/images/avatar.jpg"
  url = "https://baldanders.info/spiegel/profile/"
  flickr = "spiegel"
  instagram = "spiegel_2007"
  license = "by-sa"
  facebook = "spiegel.im.spiegel"
+++

[WordPress] は仕事でも私用でも使ってないのでスルーしてたのだが IPA と JPCERT/CC から注意喚起が出てたので紹介しておく。

- [WordPress 4.7.2 Security Release](https://wordpress.org/news/2017/01/wordpress-4-7-2-security-release/)
- [WordPress の脆弱性対策について：IPA 独立行政法人 情報処理推進機構](http://www.ipa.go.jp/security/ciadr/vul/20170206-wordpress.html)
- [WordPress の脆弱性に関する注意喚起](https://www.jpcert.or.jp/at/2017/at170006.html)

[WordPress] 4.7.2 は1月末にリリースされ，この時に3つの脆弱性が公表されたが，それとは別に重大な脆弱性があったようだ。
[WordPress] 側は安全確保のため最新版がユーザに行き渡ったタイミングで発表を行ったと言っている[^s1]。

[^s1]: こういう特定のセキュリティ企業と契約している企業ユーザが優遇される仕組みというのは良し悪しだと思うんだけどねぇ。まぁ最近の [WordPress] は自動更新機能を備えているらしいので，あまり深刻に考えないほうがいいのかもしれないが。

{{< fig-quote title="WordPress、更新版で深刻な脆弱性を修正　安全確保のため情報公開を先送り - ITmedia エンタープライズ" link="http://www.itmedia.co.jp/enterprise/articles/1702/03/news063.html" >}}
<q>この間にSucuriをはじめとするセキュリティ企業と連携し、攻撃が発生した場合でも各社のファイアウォールで防御できる態勢を確立。自動更新を通じてWordPressの更新版が行き渡り、できるだけ多くのユーザーが保護されるのを待ってから、情報を公開したという。</q>
{{< /fig-quote >}}

今回は，この4つ目の脆弱性に絞って紹介する。
他の3つについては以下を参照のこと。
（このうち [CVE-2017-5611﻿](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-5611) のみ CVSSv3 基本評価値が7を大幅に超えている）

- [CVE-2017-5610﻿](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-5610)
- [CVE-2017-5611﻿](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-5611)
- [CVE-2017-5612﻿](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-5612)

## 脆弱性の内容

バージョン 4.7 から REST API が [WordPress] Core に組み込まれたらしいのだが，そこに脆弱性があったようだ。
この脆弱性を利用すると REST API を使って認証を回避してコンテンツを書き換えることができる。
詳しくは以下の記事を参照のこと。

- [WordPress 4.7.1 の権限昇格脆弱性について検証した | 徳丸浩の日記](http://blog.tokumaru.org/2017/02/wordpress-4.7.1-Privilege-Escalation.html)

## 影響度（CVSS）

[CVE-2015-7547](https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2017-5487) より

**CVSSv3 基本評価値 5.3 ( CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N)**

| 基本評価基準                            | 評価値            |
|----------------------------------------:|:------------------|
| 攻撃元区分（AV）                        | ネットワーク（N） |
| 攻撃条件の複雑さ（AC）                  | 低（L）           |
| 必要な特権レベル（PR）                  | 不要（N）         |
| ユーザ関与レベル（UI）                  | 不要（N）         |
| スコープ（S）                           | 変更なし（U）     |
| 情報漏えいの可能性（機密性への影響, C） | 低（L）           |
| 情報改ざんの可能性（完全性への影響, I） | なし（N）         |
| 業務停止の可能性（可用性への影響, A）   | なし（N）         |

んー。
「情報改ざんの可能性」が「なし（N）」なわけないと思うのだが...
ちなみに「情報改ざんの可能性」が「高（H）」なら基本評価値は 8.2 になる。

CVSS については[解説ページ]({{< ref "/remark/2015/cvss-v3-metrics-in-jvn.md" >}})を参照のこと。

## 影響を受ける製品

[WordPress] 4.7 および 4.7.1

## 対策・回避策

バージョン 4.7.2 にアップデートすること。
すぐにアップデートが難しい場合は REST API を無効化すること（Web サーバ側の設定変更等が必要）。

JPCERT/CC では

{{< fig-quote title="WordPress の脆弱性に関する注意喚起" link="https://www.jpcert.or.jp/at/2017/at170006.html" >}}
<q>すでに、本脆弱性を悪用する実証コードが公開されており、JPCERT/CC にて実証コードを用いて検証した結果、WordPress のコンテンツが改ざんできることを確認しました。また、対象となる WordPress を利用していると思われる国内の複数のサイトが改ざん被害を受けています。また、本脆弱性を悪用した改ざん事例も確認されています。</q>
{{< /fig-quote >}}

と注意喚起を行っており，速やかに対策を実施する必要がある。

## ブックマーク

- [2月初めの複数の国内サイトの改ざんについてまとめてみた - piyolog](http://d.hatena.ne.jp/Kango/20170205/1486314605)
- [WordPress REST API Vulnerability Abused in Defacement Campaigns](https://blog.sucuri.net/2017/02/wordpress-rest-api-vulnerability-abused-in-defacement-campaigns.html)
- [【重要】WordPressの脆弱性についての注意喚起 | さくらインターネット](https://www.sakura.ad.jp/news/sakurainfo/newsentry.php?id=1524)
- [既に10万以上のサイトで改ざん被害　背景と対処方法を解説：WordPress脆弱性発覚、その後の状況　4.7.2リリース時に脆弱性が公開されなかった理由 - ＠IT](http://www.atmarkit.co.jp/ait/articles/1702/09/news048.html)

### CMS の管理について

- [WordPressで全ての自動更新を有効にする方法 | 気ままにマイウェイ](http://o-way.net/automatic-updating-of-wordpress/)
- [GitHub 上にホストした WordPress プラグインを自動アップデートに対応させる - Qiita](http://qiita.com/miya0001/items/25f49762283043a4fb4e)
- [WordPressをご利用のお客様へWAF設定のご案内 | さくらインターネット](https://www.sakura.ad.jp/news/sakurainfo/newsentry.php?id=1528)
- [「自分で面倒見られる子」だけが CMS を導入しなさい]({{< ref "/remark/2016/07/cms.md" >}})

[WordPress]: https://wordpress.org/ "Blog Tool, Publishing Platform, and CMS — WordPress"

## 参考図書

<div class="hreview" ><a class="item url" href="http://www.amazon.co.jp/exec/obidos/ASIN/B00LBPGFJS/baldandersinf-22/"><img src="http://ecx.images-amazon.com/images/I/51r6kpV26GL._SL160_.jpg" alt="photo" class="photo"  /></a><dl ><dt class="fn"><a class="item url" href="http://www.amazon.co.jp/exec/obidos/ASIN/B00LBPGFJS/baldandersinf-22/">フルスクラッチから1日でCMSを作る シェルスクリプト高速開発手法入門 (アスキー書籍)</a></dt><dd>上田 隆一 後藤 大地 ＵＳＰ研究所 </dd><dd>KADOKAWA / アスキー・メディアワークス 2014-07-02</dd><dd>評価<abbr class="rating" title="4"><img src="http://g-images.amazon.com/images/G/01/detail/stars-4-0.gif" alt="" /></abbr> </dd></dl><p class="similar"><a href="http://www.amazon.co.jp/exec/obidos/ASIN/B00MPDUQQI/baldandersinf-22/" target="_top"><img src="http://images.amazon.com/images/P/B00MPDUQQI.09._SCTHUMBZZZ_.jpg"  alt="サーバ／インフラエンジニア養成読本 ログ収集〜可視化編 [現場主導のデータ分析環境を構築！] (Software Design plus)"  /></a> <a href="http://www.amazon.co.jp/exec/obidos/ASIN/B00ME9TTMA/baldandersinf-22/" target="_top"><img src="http://images.amazon.com/images/P/B00ME9TTMA.09._SCTHUMBZZZ_.jpg"  alt="フロントエンドエンジニア養成読本［HTML ，CSS，JavaScriptの基本から現場で役立つ技術まで満載！］ (Software Design Plus)"  /></a> <a href="http://www.amazon.co.jp/exec/obidos/ASIN/B00LHFOTF4/baldandersinf-22/" target="_top"><img src="http://images.amazon.com/images/P/B00LHFOTF4.09._SCTHUMBZZZ_.jpg"  alt="絵で見てわかるシステムパフォーマンスの仕組み"  /></a> <a href="http://www.amazon.co.jp/exec/obidos/ASIN/B00J4KDYV4/baldandersinf-22/" target="_top"><img src="http://images.amazon.com/images/P/B00J4KDYV4.09._SCTHUMBZZZ_.jpg"  alt="はじめてUNIXで仕事をする人が読む本 (アスキー書籍)"  /></a> <a href="http://www.amazon.co.jp/exec/obidos/ASIN/B00MLUGZIS/baldandersinf-22/" target="_top"><img src="http://images.amazon.com/images/P/B00MLUGZIS.09._SCTHUMBZZZ_.jpg"  alt="すごいErlangゆかいに学ぼう！"  /></a> </p>
<p class="description" >既存の常識に凝り固まったソフトウェア・エンジニアに「痛恨の一撃」を加える快書もしくは怪書。</p>
<p class="gtools" >reviewed by <a href="#maker" class="reviewer">Spiegel</a> on <abbr class="dtreviewed" title="2014-09-21">2014/09/21</abbr> (powered by <a href="http://www.goodpic.com/mt/aws/index.html">G-Tools</a>)</p>
</div>
